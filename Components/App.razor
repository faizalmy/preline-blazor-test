<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />
    <link rel="stylesheet" href="@Assets["preline-blazor-test.styles.css"]" />
    <link rel="stylesheet" href="css/tailwind.css" />
    <ImportMap />
    <link rel="icon" type="image/png" href="favicon.png" />
    <HeadOutlet />
</head>

<body>
    <Routes />
    <PrelineNavigationHandler />
    <script src="_framework/blazor.web.js"></script>
    <script src="js/preline.js"></script>
    <script>
        // Initialize Preline components
        function initializePreline() {
            if (window.HSStaticMethods) {
                console.log('Initializing Preline components...');
                window.HSStaticMethods.autoInit();
                console.log('Preline initialization complete');
            } else {
                console.error('HSStaticMethods not available - Preline JavaScript may not have loaded');
            }
        }

        // Initialize on DOM ready
        document.addEventListener('DOMContentLoaded', function() {
            initializePreline();
        });

        // Listen for Blazor navigation events (similar to Livewire's livewire:navigated)
        document.addEventListener('DOMContentLoaded', function() {
            // Listen for Blazor's navigation events
            window.addEventListener('popstate', function() {
                // Re-initialize after browser back/forward navigation
                setTimeout(() => {
                    initializePreline();
                }, 100);
            });

            // Listen for Blazor's internal navigation events
            // This covers programmatic navigation within the SPA
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                        // Check if any added nodes contain Preline components
                        mutation.addedNodes.forEach(function(node) {
                            if (node.nodeType === 1) { // Element node
                                if (node.querySelector && (
                                    node.querySelector('[data-hs-dropdown]') ||
                                    node.querySelector('[data-hs-modal]') ||
                                    node.querySelector('[data-hs-accordion]') ||
                                    node.querySelector('.hs-dropdown') ||
                                    node.querySelector('.hs-modal') ||
                                    node.querySelector('.hs-accordion')
                                )) {
                                    setTimeout(() => {
                                        initializePreline();
                                    }, 50);
                                }
                            }
                        });
                    }
                });
            });

            // Start observing the document body for changes
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        });

        // Make function globally available for Blazor
        window.initializePreline = initializePreline;
    </script>
</body>

</html>
